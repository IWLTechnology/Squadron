/*
 * gameQuery rev. 0.7.0
 *
 * Copyright (c) 2012 Selim Arsever (http://gamequeryjs.com)
 * licensed under the MIT-License
 * minified and stripped of comments by IWLTech
 */
!function(e){var a=function(a,t){if(a.geometry===e.gameQuery.GEOMETRY_RECTANGLE){var r=t*Math.PI*2/360,i=Math.abs(Math.cos(r)*a.width/2*a.factor)+Math.abs(Math.sin(r)*a.height/2*a.factor),s=Math.abs(Math.cos(r)*a.height/2*a.factor)+Math.abs(Math.sin(r)*a.width/2*a.factor);return{x:i,y:s}}},t=function(t,r,i,s){if(t.geometry!=e.gameQuery.GEOMETRY_RECTANGLE||i.geometry!=e.gameQuery.GEOMETRY_RECTANGLE)return!1;var n=s.x+i.boundingCircle.x-t.boundingCircle.x-r.x,o=s.y+i.boundingCircle.y-t.boundingCircle.y-r.y,u=Math.atan(o/n),m=Math.abs(Math.cos(u-t.angle*Math.PI*2/360)/Math.cos(u)*n),f=Math.abs(Math.sin(u-t.angle*Math.PI*2/360)/Math.sin(u)*o),h=a(i,i.angle-t.angle);if(t.width/2*t.factor+h.x<=m||t.height/2*t.factor+h.y<=f)return!1;var m=Math.abs(-(Math.cos(u-i.angle*Math.PI*2/360)/Math.cos(u)*n)),f=Math.abs(-(Math.sin(u-i.angle*Math.PI*2/360)/Math.sin(u)*o)),h=a(t,t.angle-i.angle);return!(i.width/2*i.factor+h.x<=m)&&!(i.height/2*i.factor+h.y<=f)},r=function(a){for(var t={x:0,y:0},r=a[0];r!==e.gameQuery.playground[0]&&void 0!==r.gameQuery;)t.x+=r.gameQuery.posx,t.y+=r.gameQuery.posy,r=r.parentNode;return t},i=function(a,t){void 0===t&&(t=r(a));var i=a[0].gameQuery;return{firstRow:Math.max(Math.min(Math.floor(-t.y/i.height),i.sizey),0),lastRow:Math.max(Math.min(Math.ceil((e.gameQuery.playground[0].height-t.y)/i.height),i.sizey),0),firstColumn:Math.max(Math.min(Math.floor(-t.x/i.width),i.sizex),0),lastColumn:Math.max(Math.min(Math.ceil((e.gameQuery.playground[0].width-t.x)/i.width),i.sizex),0)}},s=function(e,a){var t=e[0].gameQuery;return{firstRow:Math.max(Math.min(a.firstRow-t.buffer,t.sizey),0),lastRow:Math.max(Math.min(a.lastRow+t.buffer,t.sizey),0),firstColumn:Math.max(Math.min(a.firstColumn-t.buffer,t.sizex),0),lastColumn:Math.max(Math.min(a.lastColumn+t.buffer,t.sizex),0)}},n=function(a,t,r){var i,s,n=a[0].gameQuery,o=a.attr("id");if(i=n.func?n.tiles(t,r)-1:n.tiles[t][r]-1,s=n.multi?n.animations:n.animations[i],i>=0){a.addSprite(e.gameQuery.tileIdPrefix+o+"_"+t+"_"+r,{width:n.width,height:n.height,posx:r*n.width,posy:t*n.height,animation:s});var u=a.find("#"+e.gameQuery.tileIdPrefix+o+"_"+t+"_"+r);n.multi?u.setAnimation(i):u[0].gameQuery.animationNumber=i,u.removeClass(e.gameQuery.spriteCssClass),u.addClass(e.gameQuery.tileCssClass),u.addClass(e.gameQuery.tileTypePrefix+i)}};e.extend({gameQuery:{Animation:function(a,t){return a=e.extend({imageURL:"",numberOfFrame:1,delta:0,rate:30,type:0,distance:0,offsetx:0,offsety:0},a),this.imageURL=a.imageURL,this.numberOfFrame=a.numberOfFrame,this.delta=a.delta,this.rate=a.rate,this.type=a.type,this.distance=a.distance,this.offsetx=a.offsetx,this.offsety=a.offsety,e.gameQuery.resourceManager.addAnimation(this,t),!0},ANIMATION_VERTICAL:1,ANIMATION_HORIZONTAL:2,ANIMATION_ONCE:4,ANIMATION_CALLBACK:8,ANIMATION_MULTI:16,ANIMATION_PINGPONG:32,GEOMETRY_RECTANGLE:1,GEOMETRY_DISC:2,refreshRate:30,resourceManager:{animations:[],sounds:[],callbacks:[],loadedAnimationsPointer:0,loadedSoundsPointer:0,preload:function(){for(var a=this.animations.length-1;a>=this.loadedAnimationsPointer;a--)this.animations[a].domO=new Image,this.animations[a].domO.src=this.animations[a].imageURL;for(var a=this.sounds.length-1;a>=this.loadedSoundsPointer;a--)this.sounds[a].load();e.gameQuery.resourceManager.waitForResources()},waitForResources:function(){for(var a=0,t=this.loadedAnimationsPointer;t<this.animations.length;t++)this.animations[t].domO.complete&&a++;for(var r=0,t=this.loadedSoundsPointer;t<this.sounds.length;t++)this.sounds[t].ready()&&r++;if(e.gameQuery.resourceManager.loadCallback){var i=(a+r)/(this.animations.length+this.sounds.length-this.loadedAnimationsPointer-this.loadedSoundsPointer)*100;e.gameQuery.resourceManager.loadCallback(i)}a+r<this.animations.length+this.sounds.length-this.loadedAnimationsPointer-this.loadedSoundsPointer?imgWait=setTimeout(function(){e.gameQuery.resourceManager.waitForResources()},100):(this.loadedAnimationsPointer=this.animations.length,this.loadedSoundsPointer=this.sounds.length,e.gameQuery.scenegraph.children().each(function(){e(this).children().each(arguments.callee),this.gameQuery&&this.gameQuery.animation&&(e(this).css("background-image","url("+this.gameQuery.animation.imageURL+")"),this.gameQuery.animation.type&e.gameQuery.ANIMATION_VERTICAL?e(this).css("background-repeat","repeat-x"):this.gameQuery.animation.type&e.gameQuery.ANIMATION_HORIZONTAL?e(this).css("background-repeat","repeat-y"):e(this).css("background-repeat","no-repeat"))}),0===e.gameQuery.state&&setInterval(function(){e.gameQuery.resourceManager.refresh()},e.gameQuery.refreshRate),e.gameQuery.state=1,e.gameQuery.startCallback&&e.gameQuery.startCallback(),e.gameQuery.scenegraph.css("visibility","visible"))},refreshSprite:function(){if(void 0!=this.gameQuery){var a=this.gameQuery;a.animation&&(a.idleCounter==a.animation.rate-1&&a.playing&&(a.animation.type&e.gameQuery.ANIMATION_ONCE?a.currentFrame<a.animation.numberOfFrame-1?a.currentFrame+=a.frameIncrement:a.currentFrame==a.animation.numberOfFrame-1&&a.animation.type&e.gameQuery.ANIMATION_CALLBACK&&e.isFunction(a.callback)&&a.callback(this):(a.animation.type&e.gameQuery.ANIMATION_PINGPONG&&(a.currentFrame==a.animation.numberOfFrame-1&&1==a.frameIncrement?a.frameIncrement=-1:0==a.currentFrame&&-1==a.frameIncrement&&(a.frameIncrement=1)),a.currentFrame=(a.currentFrame+a.frameIncrement)%a.animation.numberOfFrame,0==a.currentFrame&&a.animation.type&e.gameQuery.ANIMATION_CALLBACK&&e.isFunction(a.callback)&&a.callback(this)),a.animation.type&e.gameQuery.ANIMATION_VERTICAL&&a.animation.numberOfFrame>1?a.multi?e(this).css("background-position",""+(-a.animation.offsetx-a.multi)+"px "+(-a.animation.offsety-a.animation.delta*a.currentFrame)+"px"):e(this).css("background-position",""+-a.animation.offsetx+"px "+(-a.animation.offsety-a.animation.delta*a.currentFrame)+"px"):a.animation.type&e.gameQuery.ANIMATION_HORIZONTAL&&a.animation.numberOfFrame>1&&(a.multi?e(this).css("background-position",""+(-a.animation.offsetx-a.animation.delta*a.currentFrame)+"px "+(-a.animation.offsety-a.multi)+"px"):e(this).css("background-position",""+(-a.animation.offsetx-a.animation.delta*a.currentFrame)+"px "+-a.animation.offsety+"px"))),a.idleCounter=(a.idleCounter+1)%a.animation.rate)}return!0},refreshTilemap:function(){if(void 0!=this.gameQuery){var a=this.gameQuery;if(e.isArray(a.frameTracker))for(var t=0;t<a.frameTracker.length;t++)a.idleCounter[t]==a.animations[t].rate-1&&(a.animations[t].type&e.gameQuery.ANIMATION_ONCE?a.frameTracker[t]<a.animations[t].numberOfFrame-1&&(a.frameTracker[t]+=a.frameIncrement[t]):(a.animations[t].type&e.gameQuery.ANIMATION_PINGPONG&&(a.frameTracker[t]==a.animations[t].numberOfFrame-1&&1==a.frameIncrement[t]?a.frameIncrement[t]=-1:0==a.frameTracker[t]&&-1==a.frameIncrement[t]&&(a.frameIncrement[t]=1)),a.frameTracker[t]=(a.frameTracker[t]+a.frameIncrement[t])%a.animations[t].numberOfFrame)),a.idleCounter[t]=(a.idleCounter[t]+1)%a.animations[t].rate;else a.idleCounter==a.animations.rate-1&&(a.animations.type&e.gameQuery.ANIMATION_ONCE?a.frameTracker<a.animations.numberOfFrame-1&&(a.frameTracker+=a.frameIncrement):(a.animations.type&e.gameQuery.ANIMATION_PINGPONG&&(a.frameTracker==a.animations.numberOfFrame-1&&1==a.frameIncrement?a.frameIncrement=-1:0==a.frameTracker&&-1==a.frameIncrement&&(a.frameIncrement=1)),a.frameTracker=(a.frameTracker+a.frameIncrement)%a.animations.numberOfFrame)),a.idleCounter=(a.idleCounter+1)%a.animations.rate;e(this).find("."+e.gameQuery.tileCssClass).each(function(){if(e.isArray(a.frameTracker)){var t=this.gameQuery.animationNumber;a.animations[t].type&e.gameQuery.ANIMATION_VERTICAL&&a.animations[t].numberOfFrame>1?e(this).css("background-position",""+-a.animations[t].offsetx+"px "+(-a.animations[t].offsety-a.animations[t].delta*a.frameTracker[t])+"px"):a.animations[t].type&e.gameQuery.ANIMATION_HORIZONTAL&&a.animations[t].numberOfFrame>1&&e(this).css("background-position",""+(-a.animations[t].offsetx-a.animations[t].delta*a.frameTracker[t])+"px "+-a.animations[t].offsety+"px")}else a.animations.type&e.gameQuery.ANIMATION_VERTICAL&&a.animations.numberOfFrame>1?e(this).css("background-position",""+(-a.animations.offsetx-this.gameQuery.multi)+"px "+(-a.animations.offsety-a.animations.delta*a.frameTracker)+"px"):a.animations.type&e.gameQuery.ANIMATION_HORIZONTAL&&a.animations.numberOfFrame>1&&e(this).css("background-position",""+(-a.animations.offsetx-a.animations.delta*a.frameTracker)+"px "+(-a.animations.offsety-this.gameQuery.multi)+"px")})}return!0},refresh:function(){if(1===e.gameQuery.state){e.gameQuery.playground.find("."+e.gameQuery.spriteCssClass).each(this.refreshSprite),e.gameQuery.playground.find("."+e.gameQuery.tilemapCssClass).each(this.refreshTilemap);for(var a=[],t=this.callbacks.length-1;t>=0;t--){if(this.callbacks[t].idleCounter==this.callbacks[t].rate-1){var r=this.callbacks[t].fn();"boolean"==typeof r?r&&a.push(t):"number"==typeof r&&(this.callbacks[t].rate=Math.round(r/e.gameQuery.refreshRate),this.callbacks[t].idleCounter=0)}this.callbacks[t].idleCounter=(this.callbacks[t].idleCounter+1)%this.callbacks[t].rate}for(var t=a.length-1;t>=0;t--)this.callbacks.splice(a[t],1)}},addAnimation:function(a,t){if(0>e.inArray(a,this.animations))switch(a.rate=Math.round(a.rate/e.gameQuery.refreshRate),0==a.rate&&(a.rate=1),this.animations.push(a),e.gameQuery.state){case 0:case 2:break;case 1:this.animations[this.loadedAnimationsPointer].domO=new Image,this.animations[this.loadedAnimationsPointer].domO.src=a.imageURL,void 0!==t&&(this.animations[this.loadedAnimationsPointer].domO.onload=t),this.loadedAnimationsPointer++}},addSound:function(a,t){if(0>e.inArray(a,this.sounds))switch(this.sounds.push(a),e.gameQuery.state){case 0:case 2:break;case 1:a.load(),this.loadedSoundsPointer++}},registerCallback:function(a,t){0==(t=Math.round(t/e.gameQuery.refreshRate))&&(t=1),this.callbacks.push({fn:a,rate:t,idleCounter:0})},clear:function(e){this.animations=[],this.loadedAnimationsPointer=0,this.sounds=[],this.loadedSoundsPointer=0,e&&(this.callbacks=[])}},update:function(a,t){if(e.isPlainObject(a))var r=a;else if(a.length>0)var r=a[0].gameQuery;else var r=a.gameQuery;if(r){if(!0===r.tileSet){var o=i(a),u=r.buffered;for(property in t)switch(property){case"x":if(o.lastColumn>u.lastColumn){for(var m=a[0].parentNode,f=a.detach(),h=s(a,o),c=r.buffered.firstRow;c<r.buffered.lastRow;c++){for(var l=r.buffered.firstColumn;l<Math.min(h.firstColumn,r.buffered.lastColumn);l++)f.find("#"+e.gameQuery.tileIdPrefix+a.attr("id")+"_"+c+"_"+l).remove();for(var l=Math.max(r.buffered.lastColumn,h.firstColumn);l<h.lastColumn;l++)n(f,c,l)}r.buffered.firstColumn=h.firstColumn,r.buffered.lastColumn=h.lastColumn,f.appendTo(m)}if(o.firstColumn<u.firstColumn){for(var m=a[0].parentNode,f=a.detach(),h=s(a,o),c=r.buffered.firstRow;c<r.buffered.lastRow;c++){for(var l=Math.max(h.lastColumn,r.buffered.firstColumn);l<r.buffered.lastColumn;l++)f.find("#"+e.gameQuery.tileIdPrefix+a.attr("id")+"_"+c+"_"+l).remove();for(var l=h.firstColumn;l<Math.min(r.buffered.firstColumn,h.lastColumn);l++)n(f,c,l)}r.buffered.firstColumn=h.firstColumn,r.buffered.lastColumn=h.lastColumn,f.appendTo(m)}break;case"y":if(o.lastRow>u.lastRow){for(var m=a[0].parentNode,f=a.detach(),h=s(a,o),l=r.buffered.firstColumn;l<r.buffered.lastColumn;l++){for(var c=r.buffered.firstRow;c<Math.min(h.firstRow,r.buffered.lastRow);c++)f.find("#"+e.gameQuery.tileIdPrefix+a.attr("id")+"_"+c+"_"+l).remove();for(var c=Math.max(r.buffered.lastRow,h.firstRow);c<h.lastRow;c++)n(f,c,l)}r.buffered.firstRow=h.firstRow,r.buffered.lastRow=h.lastRow,f.appendTo(m)}if(o.firstRow<u.firstRow){for(var m=a[0].parentNode,f=a.detach(),h=s(a,o),l=r.buffered.firstColumn;l<r.buffered.lastColumn;l++){for(var c=Math.max(h.lastRow,r.buffered.firstRow);c<r.buffered.lastRow;c++)f.find("#"+e.gameQuery.tileIdPrefix+a.attr("id")+"_"+c+"_"+l).remove();for(var c=h.firstRow;c<Math.min(r.buffered.firstRow,h.lastRow);c++)n(f,c,l)}r.buffered.firstRow=h.firstRow,r.buffered.lastRow=h.lastRow,f.appendTo(m)}}}else{var d=e.gameQuery.playground&&!e.gameQuery.playground.disableCollision;for(property in t)switch(property){case"x":d&&(r.boundingCircle.x=r.posx+r.width/2);break;case"y":d&&(r.boundingCircle.y=r.posy+r.height/2);break;case"w":case"h":r.boundingCircle.originalRadius=Math.sqrt(Math.pow(r.width,2)+Math.pow(r.height,2))/2,r.boundingCircle.radius=r.factor*r.boundingCircle.originalRadius;break;case"angle":r.angle=parseFloat(t.angle);break;case"factor":r.factor=parseFloat(t.factor),d&&(r.boundingCircle.radius=r.factor*r.boundingCircle.originalRadius)}}}},state:0,spriteCssClass:"gQ_sprite",groupCssClass:"gQ_group",tilemapCssClass:"gQ_tilemap",tileCssClass:"gQ_tile",tileTypePrefix:"gQ_tileType_",tileIdPrefix:"gQ_tile_"},muteSound:function(a){for(var t=e.gameQuery.resourceManager.sounds.length-1;t>=0;t--)e.gameQuery.resourceManager.sounds[t].muted(a)},playground:function(){return e.gameQuery.playground},loadCallback:function(a){e.gameQuery.resourceManager.loadCallback=a}});var o=e("<div class='"+e.gameQuery.spriteCssClass+"'  style='position: absolute; display: block; overflow: hidden' />"),u=e("<div class='"+e.gameQuery.groupCssClass+"'  style='position: absolute; display: block; overflow: hidden' />"),m=e("<div class='"+e.gameQuery.tilemapCssClass+"' style='position: absolute; display: block; overflow: hidden;' />");e.fn.extend({playground:function(a){if(1==this.length){if(this[0]==document)throw"Old playground usage, use $.playground() to retreive the playground and $('mydiv').playground(options) to set the div!";a=e.extend({height:320,width:480,refreshRate:30,position:"absolute",keyTracker:!1,mouseTracker:!1,disableCollision:!1},a),e.gameQuery.playground=this,e.gameQuery.refreshRate=a.refreshRate,e.gameQuery.playground[0].height=a.height,e.gameQuery.playground[0].width=a.width,e.gameQuery.playground.css({position:a.position,display:"block",overflow:"hidden",height:a.height+"px",width:a.width+"px"}).append("<div id='gQ_scenegraph' style='visibility: hidden'/>"),e.gameQuery.scenegraph=e("#gQ_scenegraph"),e.gameQuery.keyTracker={},a.keyTracker&&(e(document).keydown(function(a){e.gameQuery.keyTracker[a.keyCode]=!0}),e(document).keyup(function(a){e.gameQuery.keyTracker[a.keyCode]=!1})),e.gameQuery.mouseTracker={x:0,y:0};var t=e.gameQuery.playground.offset();a.mouseTracker&&(e(e.gameQuery.playground).mousemove(function(a){e.gameQuery.mouseTracker.x=a.pageX-t.left,e.gameQuery.mouseTracker.y=a.pageY-t.top}),e(document).mousedown(function(a){e.gameQuery.mouseTracker[a.which]=!0}),e(document).mouseup(function(a){e.gameQuery.mouseTracker[a.which]=!1}))}return this},startGame:function(a){return e.gameQuery.startCallback=a,e.gameQuery.resourceManager.preload(),this},pauseGame:function(){return e.gameQuery.state=2,e.gameQuery.scenegraph.css("visibility","hidden"),this},resumeGame:function(a){return 2===e.gameQuery.state&&(e.gameQuery.startCallback=a,e.gameQuery.resourceManager.preload()),this},clearScenegraph:function(){return e.gameQuery.scenegraph.empty(),this},clearAll:function(a){return e.gameQuery.scenegraph.empty(),e.gameQuery.resourceManager.clear(a),this},addGroup:function(a,t){t=e.extend({width:32,height:32,posx:0,posy:0,posz:0,posOffsetX:0,posOffsetY:0,overflow:"visible",geometry:e.gameQuery.GEOMETRY_RECTANGLE,angle:0,factor:1,factorh:1,factorv:1},t);var r=u.clone().attr("id",a).css({overflow:t.overflow,top:t.posy,left:t.posx,height:t.height,width:t.width});return this==e.gameQuery.playground?e.gameQuery.scenegraph.append(r):(this==e.gameQuery.scenegraph||this.hasClass(e.gameQuery.groupCssClass))&&this.append(r),r[0].gameQuery=t,r[0].gameQuery.boundingCircle={x:t.posx+t.width/2,y:t.posy+t.height/0,originalRadius:Math.sqrt(Math.pow(t.width,2)+Math.pow(t.height,2))/2},r[0].gameQuery.boundingCircle.radius=r[0].gameQuery.boundingCircle.originalRadius,r[0].gameQuery.group=!0,this.pushStack(r)},addSprite:function(a,t){t=e.extend({width:32,height:32,posx:0,posy:0,posz:0,posOffsetX:0,posOffsetY:0,idleCounter:0,currentFrame:0,frameIncrement:1,geometry:e.gameQuery.GEOMETRY_RECTANGLE,angle:0,factor:1,playing:!0,factorh:1,factorv:1},t);var r=o.clone().attr("id",a).css({height:t.height,width:t.width,left:t.posx,top:t.posy,backgroundPosition:(t.animation?-t.animation.offsetx:0)+"px "+(t.animation?-t.animation.offsety:0)+"px"});this==e.gameQuery.playground?e.gameQuery.scenegraph.append(r):this.append(r),t.animation&&(1===e.gameQuery.state&&""!==t.animation.imageURL&&r.css("background-image","url("+t.animation.imageURL+")"),t.animation.type&e.gameQuery.ANIMATION_VERTICAL?r.css("background-repeat","repeat-x"):t.animation.type&e.gameQuery.ANIMATION_HORIZONTAL?r.css("background-repeat","repeat-y"):r.css("background-repeat","no-repeat"));var i=r[0];return void 0!=i&&(i.gameQuery=t,i.gameQuery.boundingCircle={x:t.posx+t.width/2,y:t.posy+t.height/2,originalRadius:Math.sqrt(Math.pow(t.width,2)+Math.pow(t.height,2))/2},i.gameQuery.boundingCircle.radius=i.gameQuery.boundingCircle.originalRadius),this},addTilemap:function(a,t,r,o){o=e.extend({width:32,height:32,sizex:32,sizey:32,posx:0,posy:0,posz:0,posOffsetX:0,posOffsetY:0,factorh:1,factorv:1,buffer:1},o);var u=m.clone().attr("id",a).css({top:o.posy,left:o.posx,height:o.height*o.sizey,width:o.width*o.sizex});this==e.gameQuery.playground?e.gameQuery.scenegraph.append(u):this.append(u),u[0].gameQuery=o;var f=u[0].gameQuery;if(f.tileSet=!0,f.tiles=t,f.func="function"==typeof t,e.isArray(r)){for(var h=[],c=[],l=[],d=0;d<r.length;d++)h[d]=0,c[d]=0,l[d]=1;f.frameTracker=h,f.animations=r,f.idleCounter=c,f.frameIncrement=l,f.multi=!1}else f.frameTracker=0,f.frameIncrement=1,f.animations=r,f.idleCounter=0,f.multi=!0;var g=i(u),y=s(u,g);f.buffered=y;for(var d=y.firstRow;d<y.lastRow;d++)for(var p=y.firstColumn;p<y.lastColumn;p++)n(u,d,p);return this.pushStack(u)},pauseAnimation:function(){return this[0].gameQuery.playing=!1,this},resumeAnimation:function(){return this[0].gameQuery.playing=!0,this},setAnimation:function(a,t){var r=this[0].gameQuery;if("number"==typeof a){if(r.animation.type&e.gameQuery.ANIMATION_MULTI){var i=r.animation.distance*a;r.multi=i,r.frameIncrement=1,r.currentFrame=0,r.animation.type&e.gameQuery.ANIMATION_VERTICAL?this.css("background-position",""+(-i-r.animation.offsetx)+"px "+-r.animation.offsety+"px"):r.animation.type&e.gameQuery.ANIMATION_HORIZONTAL&&this.css("background-position",""+-r.animation.offsetx+"px "+(-i-r.animation.offsety)+"px")}}else a?(r.animation=a,r.currentFrame=0,r.frameIncrement=1,""!==a.imageURL&&this.css("backgroundImage","url('"+a.imageURL+"')"),this.css({"background-position":""+-a.offsetx+"px "+-a.offsety+"px"}),r.animation.type&e.gameQuery.ANIMATION_VERTICAL?this.css("background-repeat","repeat-x"):r.animation.type&e.gameQuery.ANIMATION_HORIZONTAL?this.css("background-repeat","repeat-y"):this.css("background-repeat","no-repeat")):this.css("background-image","");return void 0!=t&&(this[0].gameQuery.callback=t),this},registerCallback:function(a,t){return e.gameQuery.resourceManager.registerCallback(a,t),this},collision:function(a,r){e.isPlainObject(a)?s=a:"string"==typeof a&&(i=a),e.isPlainObject(r)?s=r:"string"==typeof r&&(i=r);for(var i,s,n=[],o=this[0].parentNode,u=0,m=0;o!=e.gameQuery.playground[0];)o.gameQuery&&(u+=o.gameQuery.posx,m+=o.gameQuery.posy),o=o.parentNode;var f={top:0,left:0,bottom:e.playground().height(),right:e.playground().width()},h=jQuery.extend(!0,{},this[0].gameQuery),c=jQuery.extend(!0,{},h.boundingCircle);if(s&&s.w&&(h.width=s.w),s&&s.h&&(h.height=s.h),c.originalRadius=Math.sqrt(Math.pow(h.width,2)+Math.pow(h.height,2))/2,c.radius=h.factor*c.originalRadius,s&&s.x&&(c.x=s.x+h.width/2),s&&s.y&&(c.y=s.y+h.height/2),h.boundingCircle=c,h.boundingCircle.y+h.boundingCircle.radius+m<f.top||h.boundingCircle.x+h.boundingCircle.radius+u<f.left||h.boundingCircle.y-h.boundingCircle.radius+m>f.bottom||h.boundingCircle.x-h.boundingCircle.radius+u>f.right)return this.pushStack(new e([]));if(this!==e.gameQuery.playground){var l=[];l.push(e.gameQuery.scenegraph.children(i).get()),l[0].offsetX=0,l[0].offsetY=0;for(var d=0,g=l.length;d<g;d++)for(var y=l[d].length;y--;){var p=l[d][y];if(p.gameQuery){!p.gameQuery.group&&!p.gameQuery.tileSet&&this[0]!=p&&Math.sqrt(Math.pow(m+h.boundingCircle.y-l[d].offsetY-p.gameQuery.boundingCircle.y,2)+Math.pow(u+h.boundingCircle.x-l[d].offsetX-p.gameQuery.boundingCircle.x,2))-h.boundingCircle.radius-p.gameQuery.boundingCircle.radius<=0&&t(h,{x:u,y:m},p.gameQuery,{x:l[d].offsetX,y:l[d].offsetY})&&n.push(l[d][y]);var Q=e(p).children(i);Q.length&&(l.push(Q.get()),l[g].offsetX=p.gameQuery.posx+l[d].offsetX,l[g].offsetY=p.gameQuery.posy+l[d].offsetY,g++)}}return this.pushStack(e(n))}},addSound:function(a,t){if(e.gameQuery.SoundWrapper){var r=this[0].gameQuery;if(t){var i=r.sounds;i?i.push(a):r.sounds=[a]}else r.sounds=[a]}return this},playSound:function(){return e(this).each(function(){var e=this.gameQuery;if(e.sounds)for(var a=e.sounds.length-1;a>=0;a--)e.sounds[a].play()}),this},stopSound:function(){return e(this).each(function(){var e=this.gameQuery;if(e.sounds)for(var a=e.sounds.length-1;a>=0;a--)e.sounds[a].stop()}),this},pauseSound:function(){return e(this).each(function(){var e=this.gameQuery;if(e.sounds)for(var a=e.sounds.length-1;a>=0;a--)e.sounds[a].pause()}),this},muteSound:function(a){return e(this).each(function(){var e=this.gameQuery;if(e.sounds)for(var t=e.sounds.length-1;t>=0;t--)e.sounds[t].muted(a)}),this},transform:function(a,t){var r=this[0].gameQuery;if(e.gameQuery.update(r,{angle:a,factor:t}),this.css("MozTransform")){var i="rotate("+a+"deg) scale("+t*r.factorh+","+t*r.factorv+")";this.css("MozTransform",i)}else if(this.css("-o-transform")){var i="rotate("+a+"deg) scale("+t*r.factorh+","+t*r.factorv+")";this.css("-o-transform",i)}else if(null!==this.css("msTransform")&&void 0!==this.css("msTransform")){var i="rotate("+a+"deg) scale("+t*r.factorh+","+t*r.factorv+")";this.css("msTransform",i)}else if(null!==this.css("WebkitTransform")&&void 0!==this.css("WebkitTransform")){var i="rotate("+a+"deg) scale("+t*r.factorh+","+t*r.factorv+")";this.css("WebkitTransform",i)}else if(void 0!==this.css("filter")){var s=2*Math.PI/360*a,n=Math.cos(s)*t,o=Math.sin(s)*t;this.css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+n*r.factorh+",M12="+-o*r.factorv+",M21="+o*r.factorh+",M22="+n*r.factorv+",SizingMethod='auto expand',FilterType='nearest neighbor')");var u=this.width(),m=this.height();r.posOffsetX=(u-r.width)/2,r.posOffsetY=(m-r.height)/2,this.css("left",""+(r.posx-r.posOffsetX)+"px"),this.css("top",""+(r.posy-r.posOffsetY)+"px")}return this},rotate:function(e){var a,t=this[0].gameQuery;if(void 0!==e)return this.transform(e%360,this.scale());return t.angle||0},scale:function(e){var a,t=this[0].gameQuery;if(void 0!==e)return this.transform(this.rotate(),e);return t.factor||1},fliph:function(e){var a=this[0].gameQuery;return void 0===e?void 0!==a.factorh&&-1===a.factorh:(e?a.factorh=-1:a.factorh=1,this.transform(this.rotate(),this.scale()))},flipv:function(e){var a=this[0].gameQuery;return void 0===e?void 0!==a.factorv&&-1===a.factorv:(e?a.factorv=-1:a.factorv=1,this.transform(this.rotate(),this.scale()))},xyz:function(e,a,t,r){return void 0===e?this.getxyz():this.setxyz({x:e,y:a,z:t},r)},x:function(e,a){return void 0===e?this.getxyz().x:this.setxyz({x:e},a)},y:function(e,a){return void 0===e?this.getxyz().y:this.setxyz({y:e},a)},z:function(e,a){return void 0===e?this.getxyz().z:this.setxyz({z:e},a)},xy:function(e,a,t){return void 0===e?this.getxyz():this.setxyz({x:e,y:a},t)},wh:function(e,a,t){return void 0===e?this.getwh():this.setwh({w:e,h:a},t)},w:function(e,a){return void 0===e?this.getwh().w:this.setwh({w:e},a)},h:function(e,a){return void 0===e?this.getwh().h:this.setwh({h:e},a)},getxyz:function(){var e=this[0].gameQuery;return{x:e.posx,y:e.posy,z:e.posz}},setxyz:function(a,t){var r=this[0].gameQuery;for(coordinate in a)switch(coordinate){case"x":t&&(a.x+=r.posx),r.posx=a.x,this.css("left",""+(r.posx+r.posOffsetX)+"px"),this.find("."+e.gameQuery.tilemapCssClass).each(function(){e(this).x(0,!0)});break;case"y":t&&(a.y+=r.posy),r.posy=a.y,this.css("top",""+(r.posy+r.posOffsetY)+"px"),this.find("."+e.gameQuery.tilemapCssClass).each(function(){e(this).y(0,!0)});break;case"z":t&&(a.z+=r.posz),r.posz=a.z,this.css("z-index",r.posz)}return e.gameQuery.update(this,a),this},getwh:function(){var e=this[0].gameQuery;return{w:e.width,h:e.height}},setwh:function(a,t){var r=this[0].gameQuery;for(coordinate in a)switch(coordinate){case"w":t&&(a.w+=r.width),r.width=a.w,this.css("width",""+r.width+"px");break;case"h":t&&(a.h+=r.height),r.height=a.h,this.css("height",""+r.height+"px")}return e.gameQuery.update(this,a),this}}),e.extend({gQ:e.gameQuery})}(jQuery);